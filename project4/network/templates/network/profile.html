{% extends "network/layout.html" %} {% block body %} {% load static %}

<div class="d-flex justify-content-center my-4">
  <div class="card mb-3 border-0" style="max-width: 700px">
    <div class="row g-0">
      <div class="col-md-4">
        <img
          src="{% static 'network/user.png' %}"
          class="img-fluid rounded-start"
          width="200"
          alt="user"
        />
      </div>
      <div class="col-md-8">
        <div class="card-body">
          <h5 class="card-title">{{profile.username}}</h5>
          <p class="card-text">
            This is the users bio. Lorem Ipsum is simply dummy text of the
            printing and typesetting industry.
          </p>
          <div  class="row text-muted mb-2">
            <div class="col-6 col-sm-3">
              <strong>{{ followingcount }}</strong> Following
            </div>
            <div  class="col-6 col-sm-3">
              <strong>{{ followercount }}</strong> Followers
            </div>
          </div>
          {% if user.is_authenticated %} 
          {% if user.username != profile.username%}
          <div id="follow_button"></div>
          {% endif %} 
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>

{% for post in newpost %}
<div class="d-flex align-items-center justify-content-center">
  <div class="card w-50 mx-5 mb-1">
    <div class="card-body">
      <div>
        <p style="display: inline" class="font-weight-bold mr-3">
          <strong>{{post.user}}</strong>
        </p>
        <small style="float: right" class="text-muted text-end"
          >{{post.date}}</small
        >
        <p class="my-2">{{post.content }}</p>

        <div class="row row-cols-3 mt-3">
          {% if user == post.user%}
            <div class="col-sm-1"><a href="#" data-bs-toggle="modal" data-bs-target="#editModal" value="{{post.id}}" style="color: inherit; "><i class="fa-solid fa-pen-to-square"></i></a></div>
            {% endif %}
          <div class="col-sm-1">
            <a href="{% url 'login' %}" style="color: inherit"
              ><i class="fa-solid fa-heart" style="color: red"></i
            ></a>
          </div>
          <div class="col-sm-1">
            <a href="#" style="color: inherit"
              ><i class="fa-solid fa-comment"></i
            ></a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


{% endfor %}

<nav class="mt-4" aria-label="Page navigation example">
  <ul class="pagination justify-content-center">
    {% if newpost.has_previous %}
          <li class="page-item"><a class="page-link" href="?page={{ newpost.previous_page_number }}" tabindex="-1" aria-disabled="true">Previous</a></li>
      {% endif %}
    
    {% if newpost.has_next %}
          <li class="page-item"><a class="page-link" href="?page={{ newpost.next_page_number }}">Next</a></li>
      {% endif %}

  </ul>
</nav>

<script type="text/babel">

  let profile_id = "{{profile.id}}";
  let csrftoken = "{{ csrf_token }}";
  let isfollowing = ("{{is_following}}" === "True");




  function App() {

    const [count, setCount] = React.useState(0);
    
    function putdetails(arg) {
        fetch(`/follow/${profile_id}`, {
            method: 'PUT',
            headers:{'X-CSRFToken':csrftoken},
            body: JSON.stringify({
                follow: arg,
            })
        });
    }

    function onCount() {
      setCount(2);
      putdetails(true);
    }

    function offCount() {
      setCount(1);
      putdetails(false);
    }

    let button = "";

    if (isfollowing) {
      button = (<button onClick={offCount} type="button" class="btn btn-outline-primary btn-sm">Unfollow</button>);
    } else {
      button = (<button onClick={onCount} type="button" class="btn btn-primary btn-sm">Follow</button>);
    }

    if (count === 2) {
      button = (<button onClick={offCount} type="button" class="btn btn-outline-primary btn-sm">Unfollow</button>);
    } else if (count === 1) {
      button = (<button onClick={onCount} type="button" class="btn btn-primary btn-sm">Follow</button>);
    }

    return (
      <div>
          {button}
      </div>
    );
  }

  ReactDOM.render(<App />, document.querySelector("#follow_button"));
</script>

{% endblock %}
